async function executeScan() {
    const params = new URLSearchParams(window.location.search);
    try {
        const options = {
            publicKey: {
                challenge: window.crypto.getRandomValues(new Uint8Array(32)),
                rp: { name: "SL_Logistics" },
                // FIX: We use a STATIC user ID so the hardware compares the finger 
                // against a single "bucket" of fingerprints.
                user: { 
                    id: new TextEncoder().encode("SL_WAREHOUSE_GLOBAL"), 
                    name: "Global_Worker", 
                    displayName: "Warehouse Terminal" 
                },
                pubKeyCredParams: [{ alg: -7, type: "public-key" }],
                authenticatorSelection: { 
                    authenticatorAttachment: "platform",
                    userVerification: "required",
                    residentKey: "required", 
                    requireResidentKey: true
                },
                attestation: "direct",
                timeout: 60000
            }
        };

        const credential = await navigator.credentials.create(options);
        
        // We capture the rawId. If it's the same finger under the same User ID,
        // the hardware should return the same Credential ID.
        const credId = btoa(String.fromCharCode.apply(null, new Uint8Array(credential.rawId)));
        
        window.location.href = `${params.get('returnUrl')}?credId=${encodeURIComponent(credId)}&icid=${params.get('icid')}&action=${params.get('action')}`;

    } catch (e) {
        alert("Security Error: " + e.message);
    }
}
